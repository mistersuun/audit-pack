{% extends "base.html" %}
{% block title %}FAQ{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h1>FAQ</h1>
        <p>Réponses rapides pour l’audit de nuit</p>
    </div>
</div>

<section class="faq-hero">
    <div class="faq-hero-left">
        <div class="faq-hero-title">
            <span class="eyebrow">Support audit</span>
            <h2>Questions fréquentes</h2>
            <p>Guides rapides Front et Back, impressions, balances, classements et timing PART.</p>
        </div>
        <div class="faq-stats">
            <div class="faq-stat-card">
                <div class="stat-label">Entrées FAQ</div>
                <div class="stat-value">{{ faqs|length }}</div>
            </div>
            <div class="faq-stat-card">
                <div class="stat-label">Front</div>
                <div class="stat-value">{{ front_count }}</div>
            </div>
            <div class="faq-stat-card">
                <div class="stat-label">Back</div>
                <div class="stat-value">{{ back_count }}</div>
            </div>
        </div>
    </div>
    <div class="faq-hero-right">
        <div class="faq-search">
            <input type="text" id="faq-search" placeholder="Rechercher (ex: Transelect, VNC, DueBack)..." oninput="filterFAQ()">
        </div>
        <div class="faq-tags">
            <button class="tag-btn active" data-tag="all" onclick="filterTag(this)">Tous</button>
            {% for tag in tags %}
            <button class="tag-btn" data-tag="{{ tag|lower }}" onclick="filterTag(this)">{{ tag }}</button>
            {% endfor %}
        </div>
    </div>
</section>

<div class="faq-layout">
    <div class="faq-list">
        {% for item in faqs %}
        <div class="faq-item" data-tags="{{ item.tags|join(',') if item.tags else '' }}">
            <button class="faq-question" onclick="toggleFAQ(this)">
                <span>{{ item.q }}</span>
                <i data-feather="chevron-down"></i>
            </button>
            <div class="faq-answer">
                {{ item.a|safe }}
            </div>
        </div>
        {% endfor %}
    </div>
    <aside class="faq-glossary">
        <div class="glossary-title">Filtres rapides</div>
        <ul>
            <li onclick="quickFilter('front')">Front</li>
            <li onclick="quickFilter('back')">Back</li>
            <li onclick="quickFilter('impressions')">Impressions</li>
            <li onclick="quickFilter('moneris')">Moneris / PART</li>
            <li onclick="quickFilter('cartes')">Cartes / Transelect</li>
            <li onclick="quickFilter('classement')">Classement / Piles</li>
        </ul>
    </aside>
</div>
{% endblock %}

{% block scripts %}
<script>
feather.replace();
function filterFAQ() {
    const term = document.getElementById('faq-search').value.toLowerCase();
    document.querySelectorAll('.faq-item').forEach(item => {
        const text = item.innerText.toLowerCase();
        const matchesSearch = text.includes(term);
        const matchesTag = item.dataset.tagMatch !== 'false';
        item.style.display = matchesSearch && matchesTag ? 'block' : 'none';
    });
}
function toggleFAQ(btn) {
    const item = btn.parentElement;
    item.classList.toggle('open');
    const icon = btn.querySelector('i');
    if (item.classList.contains('open')) {
        icon.dataset.icon = 'chevron-up';
    } else {
        icon.dataset.icon = 'chevron-down';
    }
    feather.replace();
}
function filterTag(btn) {
    const tag = btn.dataset.tag;
    document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.faq-item').forEach(item => {
        if (tag === 'all') {
            item.dataset.tagMatch = 'true';
        } else {
            const tags = (item.dataset.tags || '').toLowerCase();
            item.dataset.tagMatch = tags.includes(tag) ? 'true' : 'false';
        }
    });
    filterFAQ();
}
function quickFilter(tag) {
    const btn = document.querySelector(`.tag-btn[data-tag=\"${tag}\"]`);
    if (btn) {
        filterTag(btn);
    }
}
</script>
{% endblock %}
